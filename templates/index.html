<!DOCTYPE html>
<html lang="en">

<head>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do App</title>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
        integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">

    <!-- DataTable CDN -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />

    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>


    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">

    <!-- DataTable CDN -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />


    <!-- ICONSCOUT CDN -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href={{url_for('static', filename='style.css')}}>
    <link rel="stylesheet" href={{url_for('static', filename='style-switcher.css')}}>
    <link rel="stylesheet" href={{url_for('static', filename='variables1.css')}} class="alternate-style" title="color-1" disabled>
    <link rel="stylesheet" href={{url_for('static', filename='variables2.css')}} class="alternate-style" title="color-2" disabled>
    <link rel="stylesheet" href={{url_for('static', filename='variables3.css')}} class="alternate-style" title="color-3" disabled>
    <link rel="stylesheet" href={{url_for('static', filename='variables4.css')}} class="alternate-style" title="color-4" disabled>
    <link rel="stylesheet" href={{url_for('static', filename='variables5.css')}} class="alternate-style" title="color-5" disabled>
    <link rel="stylesheet" href={{url_for('static', filename='variables1.css')}}>
</head>
<body>


<div class="main-content">

    <div class="aside">
        <div class="logo">
            <a href="#" style="font-size: 16px;"><span>To Do App</span></a>
        </div>

        <div class="nav-toggler">
            <span></span>
        </div>

        <ul class="nav">
            <li>
                <a href="/" class=""><i
                        class="fa fa-home"></i>Home</a>
            </li>
        </ul>

    </div>

   

</div>

<div class="main-content">
    <!-- home section start -->
    <section class="home section " id="home">
        <div class="container" style="max-width: 100%;">
            <div class="alert shadow-lg" role="alert">
                <h5 class="text-center">Please Fill User Details</h5>
            </div>

                <div class="container shadow-lg rounded" style="max-width: 100%;">
                    <div class="row d-flex justify-content-evenly">
                        <div class="col-lg-5 col-md-5 col-sm-12 shadow p-3 mb-5 bg-body rounded">
                            <form id="userForm">
                                <div class="mb-3">
                                    <label for="UserName" class="form-label">User Name</label>
                                    <input type="text" class="form-control" id="userNameId" required>
                                </div>
                                <div class="mb-3">
                                    <label for="UserEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="UserEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="UserTask" class="form-label">Task</label>
                                    <input type="text" class="form-control" name="task" id="UserTaskid" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>
                        </div>
                        <div class="col-lg-5 col-md-5 col-sm-12 shadow p-3 mb-5 bg-body rounded">
                            <table class="table table-striped">
                                <thead class="UserTableHead" id="userTableHeadId">
                                    <tr>
                                        <th scope="col">Sr No.</th>
                                        <th scope="col">User Name</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Task</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="userTableBody" id="userTableBodyId">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        </div>
    </section>
</div>


<!-- Modal for updating user details -->
<div class="modal fade" id="updateUserModal" tabindex="-1" aria-labelledby="updateUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateUserModalLabel">Update User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="updateUserName" class="form-label">User Name</label>
                    <input type="text" class="form-control" id="updateUserName" required>
                </div>
                <div class="mb-3">
                    <label for="updateUserEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="updateUserEmail" required>
                </div>

                <div class="mb-3">
                    <label for="updateUserTask" class="form-label">Task</label>
                    <input type="text" class="form-control" name="task" id="updateUserTaskid" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="updateUserButton">Update</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(() => {
        fetchAllUsers();

        $('#userForm').on('submit', function (e) {
            e.preventDefault();
            const userName = $('#userNameId').val();
            const userEmail = $('#UserEmail').val();
            const userTask = $('#UserTaskid').val();

            $.ajax({
                url: '/addUser',
                type: 'POST',
                data: JSON.stringify({ name: userName, email: userEmail,userTask : userTask }),
                contentType: 'application/json',
                success: function (response) {
                    if (response.success) {
                        alert('User added successfully');
                        fetchAllUsers();
                        $('#userForm')[0].reset();
                    } else {
                        alert('Error adding user');
                    }
                },
                error: function (err) {
                    console.error(err);
                    alert('Error occurred while adding user');
                }
            });
        });

        $('#updateUserButton').on('click', function () {
            const userId = $(this).data('user-id');
            const updatedUserName = $('#updateUserName').val();
            const updatedUserEmail = $('#updateUserEmail').val();
            const updateTask = $('#updateUserTaskid').val();

            updateUserById(userId, { name: updatedUserName, email: updatedUserEmail , task: updateTask });
            $('#updateUserModal').modal('hide');  // Hide the modal
        });
    });

    function fetchAllUsers() {
        $.ajax({
            url: '/getAllUsers',
            type: 'GET',
            success: function (users) {
                const userTableBody = $('#userTableBodyId');
                userTableBody.empty();

                users.body.forEach((user, index) => {
                    userTableBody.append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${user[1]}</td>
                            <td>${user[2]}</td>
                            <td>${user[3] ? user[3] : "-"}</td>
                            <td>
                                <button onclick="fetchUserById(${user[0]})" class="btn btn-info">Fetch</button>
                                <button onclick="deleteUserById(${user[0]})" class="btn btn-danger mx-1">Delete</button>
                            </td>
                        </tr>
                    `);
                });
            },
            error: function (err) {
                console.error(err);
                alert('Error fetching users');
            }
        });
    }

    function fetchUserById(id) {
        $.ajax({
            url: `/getUserById/${id}`,
            type: 'GET',
            success: function (user) {
                if (user.success) {
                    var aData = user.user;
                    $('#updateUserName').val(aData[1]);
                    $('#updateUserEmail').val(aData[2]);
                    $('#updateUserTaskid').val(aData[3]);
                    $('#updateUserButton').data('user-id', aData[0]); // Store user ID in the button
                    $('#updateUserModal').modal('show'); // Show the modal
                } else {
                    alert('User not found');
                }
            },
            error: function (err) {
                console.error(err);
                alert('Error fetching user');
            }
        });
    }

    function deleteUserById(id) {
        $.ajax({
            url: `/deleteUser/${id}`,
            type: 'DELETE',
            success: function (response) {
                if (response.success) {
                    alert('User Deleted');
                } else {
                    alert('User not found');
                }
                fetchAllUsers();  // Refresh the user list
            },
            error: function (err) {
                console.error(err);
                alert('Error deleting user');
            }
        });
    }

    function updateUserById(id, userData) {
        $.ajax({
            url: `/updateUser/${id}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(userData),  // Pass user data as JSON
            success: function (response) {
                if (response.success) {
                    alert('User updated successfully!');
                    fetchAllUsers(); // Refresh the user list
                } else {
                    alert('User update failed');
                }
            },
            error: function (err) {
                console.error(err);
                alert('Error updating user');
            }
        });
    }
</script>




<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
   integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/7aea43b38e.js" crossorigin="anonymous"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"
   integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A=="
   crossorigin="anonymous" referrerpolicy="no-referrer"></script>


   <script src={{url_for('static', filename='main.js')}} ></script>
   <script src={{url_for('static', filename='style-switcher-js.js')}} ></script>



</body>

</html>

